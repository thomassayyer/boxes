<Page x:Class="Boxes.Views.DiscoverPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Boxes.Views"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:i="using:Microsoft.Xaml.Interactivity"
      xmlns:core="using:Microsoft.Xaml.Interactions.Core"
      mc:Ignorable="d"
      DataContext="{Binding DiscoverVM, Source={StaticResource Locator}}"
      RequestedTheme="Light">

    <Grid Background="{StaticResource BackgroundBrush}"
          Padding="10">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Margin="0,15,0,15">

            <FontIcon Glyph=""
                      FontFamily="Segoe MDL2 Assets"
                      Foreground="Black"
                      HorizontalAlignment="Right"
                      Margin="10" />

            <TextBox x:ConnectionId='1' x:Name="SearchTextBox"
                     PlaceholderText="Rechercher ..."
                     x:Uid="SearchTextBox"
                     Height="48">
                <i:Interaction.Behaviors>
                    <core:EventTriggerBehavior EventName="KeyUp">
                        <core:InvokeCommandAction Command="{Binding SearchBoxCommand}"
                                                  CommandParameter="{Binding Text, ElementName=SearchTextBox}" />
                    </core:EventTriggerBehavior>
                </i:Interaction.Behaviors>
            </TextBox>

        </Grid>

        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      Grid.Row="1">

            <Grid>

                <StackPanel Orientation="Vertical"
                            Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource InverseVisibilityConverter}}">

                    <GridView ItemsSource="{Binding TopBoxes, Mode=OneWay}"
                              IsItemClickEnabled="True"
                              SelectionMode="None"
                              ItemTemplate="{StaticResource BoxesDataTemplate}"
                              Visibility="{Binding IsSearching, Mode=OneWay, Converter={StaticResource InverseVisibilityConverter}}"
                              HorizontalAlignment="Center"
                              ScrollViewer.VerticalScrollMode="Disabled">

                        <GridView.ItemContainerStyle>
                            <Style TargetType="GridViewItem">
                                <Setter Property="Margin"
                                        Value="10" />
                            </Style>
                        </GridView.ItemContainerStyle>

                        <i:Interaction.Behaviors>
                            <core:EventTriggerBehavior EventName="ItemClick">
                                <core:InvokeCommandAction Command="{Binding ShowBoxCommand}"
                                                          InputConverter="{StaticResource ItemClickedConverter}" />
                            </core:EventTriggerBehavior>
                        </i:Interaction.Behaviors>

                    </GridView>

                    <GridView ItemsSource="{Binding SearchResults, Mode=OneWay}"
                              IsItemClickEnabled="True"
                              SelectionMode="None"
                              ItemTemplate="{StaticResource BoxesDataTemplate}"
                              Visibility="{Binding IsSearching, Mode=OneWay, Converter={StaticResource VisibilityConverter}}"
                              HorizontalAlignment="Center"
                              ScrollViewer.VerticalScrollMode="Disabled">

                        <GridView.ItemContainerStyle>
                            <Style TargetType="GridViewItem">
                                <Setter Property="Margin"
                                        Value="10" />
                            </Style>
                        </GridView.ItemContainerStyle>

                        <i:Interaction.Behaviors>
                            <core:EventTriggerBehavior EventName="ItemClick">
                                <core:InvokeCommandAction Command="{Binding ShowBoxCommand}"
                                                          InputConverter="{StaticResource ItemClickedConverter}" />
                            </core:EventTriggerBehavior>
                        </i:Interaction.Behaviors>

                    </GridView>

                    <TextBlock Text=""
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="40"
                               HorizontalAlignment="Center"
                               Foreground="{StaticResource SmallBrush}" />

                </StackPanel>

                <ProgressRing Foreground="{StaticResource PrimaryBrush}"
                              IsActive="{Binding IsLoading, Mode=OneWay}"
                              Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource VisibilityConverter}}"
                              Width="48"
                              Height="48" />

            </Grid>

        </ScrollViewer>

    </Grid>
</Page>

